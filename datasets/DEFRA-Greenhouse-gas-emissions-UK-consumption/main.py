#!/usr/bin/env python
# coding: utf-8
import pandas as pd 
from gssutils import *
from csvcubed.models.cube.qb.catalog import CatalogMetadata

df = pd.read_csv("raw.csv", encoding='ISO-8859-1')

df['GHG generated directly from UK households'] = df['UK Households heating emissions arising from the use of fossil fuels'] + df['UK Transport emissions generated directly by UK households']

df.drop(columns=['UK Households heating emissions arising from the use of fossil fuels', 'UK Transport emissions generated directly by UK households'], axis=1, inplace=True)

df.rename(columns={'GHG from UK produced goods and services consumed by UK residents': 'GHG from UK produced goods and services',
               'GHG embedded in imported goods and services to UK': 'GHG embedded in imported goods and services'
               }, inplace=True) 

df = pd.melt(df, id_vars=['Year'], 
value_vars= ['GHG from UK produced goods and services', 'GHG embedded in imported goods and services', 'GHG generated directly from UK households'], 
var_name='Measure', value_name='Value')

df.to_csv('observations.csv', index=False)
catalog_metadata = CatalogMetadata(
    title = "Greenhouse gas emissions UK consumption",
    summary = "The UK's total carbon footprint since 1996",
    landing_page_uris=[
        "https://www.gov.uk/government/statistics/uks-carbon-footprint/carbon-footprint-for-the-uk-and-england-to-2019#greenhouse-gas-emissions-associated-with-consumption"],
    description = """
    The carbon footprint refers to emissions that are associated with the
    consumption spending of UK residents on goods and services,
    wherever in the world these emissions arise along the supply chain, and those
    which are directly generated by households through private motoring and burning fuel to heat homes.
    These emissions are often referred to as 'consumption emissions' to distinguish them from estimates relating to
    the emissions 'produced' within a country's territory or economic sphere.
    
    Inherently the emissions relating to overseas production of imports to the UK,
    often referred to as emissions that are 'embedded' in imports, are not as easily
    measured as emissions generated within the UK borders. There are general conventions
    on how to do this but the results cannot be viewed as being as robust as the estimates
    of carbon emissions generated domestically.
    """
)
catalog_metadata.to_json_file('catalog-metadata.json')
